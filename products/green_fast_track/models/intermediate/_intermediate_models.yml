version: 2

models:
  - name: int__all_buffers
    description: Union of all buffered flag tables
    columns:
      - name: variable_type
        test:
          - not_null
      - name: variable_id
        test:
          - not_null
      - name: raw_geom
        tests:
          - not_null
      - name: buffer
        tests:
          - not_null

  - name: int__dep_cats_permits
    description: Buffered geometries for cats permits
    columns:
      - name: variable_type
        test:
          - not_null
      - name: variable_id
        test:
          - not_null
          - unique
      - name: raw_geom
        tests:
          - not_null
      - name: buffer
        tests:
          - not_null
          - is_epsg_2263

  - name: int__edesignation_flags
    description: Flags related to edesignation
    columns:
      - name: bbl
        tests:
          - not_null
      - name: variable_type
        test:
          - not_null
      - name: variable_id
        test:
          - not_null

  - name: int__elevated_railways
    description: Buffered geometries for elevated/exposed railways
    columns:
      - name: variable_type
        test:
          - not_null
      - name: variable_id
        test:
          - not_null
      - name: raw_geom
        tests:
          - not_null
      - name: buffer
        tests:
          - not_null

  - name: int__flags
    description: A table with all flags relevant to CEQR
    columns:
      - name: bbl
        data_type: string
        test:
          - not_null
      - name: variable_type
        data_type: string
        test:
          - not_null
      - name: variable_id
        data_type: string
        test:
          - not_null
      - name: distance
        data_type: float
    tests:
      - dbt_utils.unique_combination_of_columns:
          name: int__flags_compound_key
          combination_of_columns:
            - bbl
            - variable_type
            - variable_id

  - name: int__nysdec_state_facility_permits
    description: Buffered geometries for state facility permits
    columns:
      - name: variable_type
        test:
          - not_null
      - name: variable_id
        test:
          - not_null
          - unique
      - name: raw_geom
        tests:
          - not_null
      - name: buffer
        tests:
          - not_null

  - name: int__nysdec_title_v_facility_permits
    description: Buffered geometries for title V facility permits
    columns:
      - name: variable_type
        test:
          - not_null
      - name: variable_id
        test:
          - not_null
          - unique
      - name: raw_geom
        tests:
          - not_null
      - name: buffer
        tests:
          - not_null

  - name: int__spatial_flags
    description: |
      A table featuring spatially joined BBLs with buffered variable types, 
      including distances to their raw geometry
    columns:
      - name: bbl
        data_type: string
        test:
          - not_null
      - name: variable_type
        data_type: string
        test:
          - not_null
      - name: variable_id
        data_type: string
        test:
          - not_null
      - name: distance
        data_type: float
        test:
          - not_null
    tests:
      - dbt_utils.unique_combination_of_columns:
          name: int__spatial_flags_compound_key
          combination_of_columns:
            - bbl
            - variable_type
            - variable_id

  - name: int__zoning_flags
    columns:
      - name: bbl
        data_type: string
        test:
          - not_null
      - name: variable_type
        data_type: string
        test:
          - not_null
      - name: variable_id
        data_type: string
        test:
          - not_null
      - name: distance
        data_type: float
        test:
          - not_null
    tests:
      - dbt_utils.unique_combination_of_columns:
          name: int__zoning_flags_compound_key
          combination_of_columns:
            - bbl
            - variable_type
            - variable_id
