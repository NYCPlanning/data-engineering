FROM ghcr.io/osgeo/gdal:ubuntu-small-3.6.4

# Add PG apt repo to enable PG 15 tools.
# Note: This follows https://www.postgresql.org/download/linux/ubuntu/ with one modification
# (lsb_release is broken on this image, so some longer bash is subbed in)
RUN apt -y install wget gnupg \
    && sh -c 'echo "deb https://apt.postgresql.org/pub/repos/apt $(cat /etc/os-release | grep VERSION_CODENAME | cut -d "=" -f2)-pgdg main" > /etc/apt/sources.list.d/pgdg.list' \
    && wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add -

RUN apt update && export DEBIAN_FRONTEND=noninteractive \
    && apt -y install postgresql-client-15 python3-pip python3-distutils jq zip unzip git bash-completion locales

RUN curl -O https://dl.min.io/client/mc/release/linux-amd64/mc \
    && chmod +x mc \
    && mv ./mc /usr/bin/ 

RUN wget https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64 -O /usr/bin/yq && chmod +x /usr/bin/yq

COPY bash/ bash/
COPY python python/

RUN bash/install_python_packages.sh python \
    && rm -rf bash \
    && rm -rf python
