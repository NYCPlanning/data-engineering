version: 2

sources:
  - name: recipe_sources
    schema: "{{ env_var('BUILD_ENGINE_SCHEMA') }}"
    tables:
      - name: panynj_jfk_65db
        columns:
          - name: wkb_geometry
            tests:
              - unique
              - not_null
      - name: panynj_lga_65db
        columns:
          - name: wkb_geometry
            tests:
              - unique
              - not_null

      - name: dcm_arterial_highways
        columns:
          - name: name
            tests:
              - not_null
          - name: wkb_geometry
            tests:
              - unique
              - not_null
        tests:
          - dbt_utils.unique_combination_of_columns:
              name: dcm_arterial_highways_compound_key
              combination_of_columns:
                - name
                - wkb_geometry

      - name: dcp_air_quality_vent_towers
        columns:
          - name: bbl
          - name: name
            tests:
              - unique
              - not_null
          - name: wkb_geometry
            tests:
              - unique
              - not_null

      - name: dcp_edesignation_csv
        columns:
          - name: bbl
            tests:
              - not_null
          - name: enumber
            tests:
              - not_null
          - name: hazmat_code
            tests:
              - not_null
          - name: air_code
            tests:
              - not_null
          - name: noise_code
            tests:
              - not_null

      - name: dcp_lion
        columns:
          - name: street
            tests:
              - not_null
          - name: row_type
            tests:
              - not_null
          - name: shape
            tests:
              - not_null

      - name: dcp_mappluto_wi
        columns:
          - name: bbl
            tests:
              - unique
              - not_null
          - name: zonedist1
          - name: zonedist2
          - name: zonedist3
          - name: zonedist4
          - name: spdist1
          - name: spdist2
          - name: spdist3
          - name: wkb_geometry
            tests:
              - not_null
              - is_epsg_2263:
                  config:
                    severity: warn

      - name: nysdec_title_v_facility_permits
        columns:
          - name: permit_id
            tests:
              - unique
              - not_null
          - name: facility_name
            tests:
              - dbt_utils.at_least_one
          - name: geom
            tests:
              - not_null

      - name: nysdec_state_facility_permits
        columns:
          - name: permit_id
            tests:
              - unique
              - not_null
          - name: facility_name
            tests:
              - dbt_utils.at_least_one
          - name: geom
            tests:
              - not_null

      - name: dep_cats_permits
        columns:
          - name: applicationid
            tests:
              - unique
              - not_null
          - name: status
            tests:
              - not_null
          - name: geom
            tests:
              - not_null

      - name: dcp_boroboundaries_wi

      - name: dpr_parksproperties
        columns:
          - name: objectid
            tests:
              - unique
              - not_null
          - name: wkb_geometry
            tests:
              - not_null
          - name: typecategory
            description: this column is tested to ensure each typecategory in dpr_property exists as typecategory in nyc_parks_properties_categories
            tests:
              - relationships:
                  to: ref('nyc_parks_properties_categories')
                  field: typecategory

      - name: dcp_pops
        columns:
          - name: pops_number
            tests:
              - not_null
              - unique
          - name: bbl
          - name: wkb_geometry
            tests:
              - not_null

      - name: dcp_waterfront_access_map_wpaa
        columns:
          - name: objectid
            tests:
              - not_null
              - unique
          - name: wkb_geometry
            tests:
              - not_null

      - name: dcp_waterfront_access_map_pow
        columns:
          - name: objectid
            tests:
              - not_null
              - unique
          - name: wkb_geometry
            tests:
              - not_null

      - name: nysparks_parks_polygons
        columns:
          - name: objectid
            tests:
              - not_null
              - unique
          - name: wkb_geometry
            tests:
              - not_null

      - name: usnps_parks
        columns:
          - name: objectid
            tests:
              - not_null
              - unique
          - name: wkt
            tests:
              - not_null
